## -*- mode:ulam -*-
#=t3637_test_compiler_elementandquarkwargs_nestedshadowingasconds
#!
./R.ulam:11:14: ERROR: Invalid lefthand type of conditional operator 'as'; must be an atom, element or transient, not Typo(1)&.
./System.ulam:2:7: ERROR: 1 Nodes with erroneous types detected after type labeling class: System.
./System.ulam:2:7: ERROR: 10 Nodes with unresolved types detected after type labeling class: System.
Unrecoverable Program Type Label FAILURE.
##
## informed by 3826
##
#:R.ulam
  ulam 2;
element R {
  Bool first, second;
  Int test(){
    System s;

    Eltypo elf; //transient
    elf.t.func(5u); //dm set
    if(elf as Typo(1))
    {
      if(elf as Bar){
	elf.func(3u);
	s.print(elf.bu);
	first = (elf.bu == 3); //3u, from 7u
	s.assert(first);
      }
      else
	s.assert(false);

      s.print(elf.bu);
      second = (elf.bu == 3); //3u, from 7u
      s.assert(second);
      s.assert(first);
    }
    return elf.t.bu; //5u
  }
}

#:Typo.ulam
  ulam 1;
use Bar;
quark Typo(Int a) : Bar{
}

#:Bar.ulam
  ulam 1;
quark Bar
{
  Unsigned(3) bu = 7u;
  Void func(Unsigned u)
  {
    bu = (Unsigned(3)) u;
  }
}

#:Eltypo.ulam
  ulam 2;
transient Eltypo : Typo(1) {
  Typo(1) t;
}

#:System.ulam
ulam 1;
quark System {
Void print(Unsigned arg) native;
Void print(Int arg) native;
Void print(Int(4) arg) native;
Void print(Int(3) arg) native;
Void print(Unary(3) arg) native;
Void print(Bool(3) arg) native;
Void assert(Bool b) native;
}
#.
