## -*- mode:ulam -*-
#=t3894_test_compiler_elementwithclassparameterunpackedarray
##
##  gen output: (+ assert)
##  Int Arg: 3
##
#!
Exit status: 3
Ue_T { Int(32) r(3);  Int(32) test() {  System s;  constant Int(32)[10] site = { 1 cast, 2 cast, 3 cast, 4 cast };  S(11121314141414141414,3) n;  r n ( )func . = s ( r )print . s ( r 3 cast == )assert . r return } }
Uq_System { <NOMAIN> }
Uq_S(Int(32)[10] y, Int(32) x) { <NOMAIN> }
##
##    //informed by t3444,5
##
#>T.ulam
 ulam 1;
local typedef Int BigSite[10];
element T{
  Int r;
  Int test(){
    System s;
    constant BigSite site = { 1, 2, 3, 4 };
    S(site, 3) n;
    r = n.func(); //n.y[3]; //site[3];
    s.print(r);
    s.assert(r==3);
    //return n.y[n.x];
    return r; //n.y[n.x];
  }
}

quark S(BigSite y, Int x){
  Int func()
  {
    return y[x - 1];
    //return x; ok.
  }
 }

#:System.ulam
  ulam 1;
quark System {
  Void print(Unsigned arg) native;
  Void print(Int arg) native;
  Void print(Int(4) arg) native;
  Void print(Int(3) arg) native;
  Void print(Unary(3) arg) native;
  Void print(Bool(3) arg) native;
  Void assert(Bool b) native;
}
#.
