## -*- mode:ulam -*-
#=t3974_test_compiler_stringarray_localinit_lengthof
##
## gen output: (+ interleaved asserts)
## Bool(3) Arg: 0x7 (true)
## String(7) Arg: "bar"
## Unsigned Arg: 4
##
#!
Exit status: 0
Ue_A { Bool(1) b(true);  Int(32) test() {  SystemU3 su3;  String(32) sarr[2] = { "fool", "bar" };  Bool(3) bun[2] = { false, true };  su3 ( bun 1 [] )print . su3 ( bun 1 [] cast )assert . Unsigned(8) asc = sarr 1 [] 2 [];  b asc 114u == = su3 ( sarr 1 [] )print . su3 ( b )assert . Unsigned(32) len = 4u;  su3 ( len )print . su3 ( len 4u cast == )assert . 0 cast return } }
Uq_SystemU3 : System { :<> <NOMAIN> }
Uq_System { <NOMAIN> }
##
## informed by t3973 except function local variable is an initialized string array
## also tests packloadable string array (not u64, array of 2 ints instead)
##
#>A.ulam
  ulam 2;
element A {
  Bool b;

 Int test() {
   SystemU3 su3;
   String sarr[2] = { "fool", "bar"};
   Bool(3) bun[2] = { false, true};

   su3.print(bun[1]);
   su3.assert(bun[1]);

   ASCII asc = sarr[1][2];
   b = (asc == 'r');
   su3.print(sarr[1]);
   su3.assert(b);

   Unsigned len = sarr[0].lengthof;
   su3.print(len);
   su3.assert(len == 4u);
   return 0;
 }
}

#:SystemU3.ulam
  ulam 2;
quark SystemU3 : System {
  Void print(String s) native;
}

#:System.ulam
  ulam 1;
quark System {
  Void print(Unsigned arg) native;
  Void print(Int arg) native;
  Void print(Int(4) arg) native;
  Void print(Int(3) arg) native;
  Void print(Unary(3) arg) native;
  Void print(Bool(3) arg) native;
  Void assert(Bool b) native;
}
#.
